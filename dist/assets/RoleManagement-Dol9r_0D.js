import{d as ue,e as u,l as S,f as T,m as re,c as pe,a as l,w as a,r as o,b as m,q as me,i as p,v as ce,k as ge,t as E,E as c,x as fe,o as F,_ as be}from"./index-76Zfp96_.js";const ve={class:"role-management"},_e={class:"card-header"},Ce={style:{float:"right"}},xe={class:"filter-section"},ke={style:{"margin-left":"10px"}},Ve={style:{"margin-left":"10px"}},we={class:"dialog-footer"},ye={style:{"max-height":"500px","overflow-y":"auto"}},he={class:"dialog-footer"},ze=ue({__name:"RoleManagement",setup(Pe){const x=u(!1),r=S({name:"",status:""}),d=S({currentPage:1,pageSize:10}),f=u(!1),k=u(""),V=u(!1),v=u(!1),i=S({id:0,name:"",description:"",status:"enabled"}),M={name:[{required:!0,message:"请输入角色名称",trigger:"blur"},{min:2,max:20,message:"角色名称长度应在2-20个字符之间",trigger:"blur"}],description:[{required:!0,message:"请输入角色描述",trigger:"blur"},{max:100,message:"角色描述最多100个字符",trigger:"blur"}]},C=u(),U=u(),g=u([{id:1,name:"超级管理员",description:"拥有系统所有权限",userCount:1,status:"enabled"},{id:2,name:"运营人员",description:"负责日常运营管理",userCount:3,status:"enabled"},{id:3,name:"数据分析师",description:"负责数据分析和报表制作",userCount:2,status:"enabled"},{id:4,name:"访客",description:"仅可查看部分公开数据",userCount:0,status:"disabled"}]),I=u([{id:1,label:"指标管理",children:[{id:11,label:"指标明细表管理",children:[{id:111,label:"查看"},{id:112,label:"新增"},{id:113,label:"编辑"},{id:114,label:"删除"}]},{id:12,label:"指标配置",children:[{id:121,label:"查看"},{id:122,label:"新增"},{id:123,label:"编辑"},{id:124,label:"删除"}]},{id:13,label:"指标监控",children:[{id:131,label:"查看"},{id:132,label:"新增"},{id:133,label:"编辑"},{id:134,label:"删除"}]}]},{id:2,label:"系统管理",children:[{id:21,label:"用户管理",children:[{id:211,label:"查看"},{id:212,label:"新增"},{id:213,label:"编辑"},{id:214,label:"删除"}]},{id:22,label:"角色管理",children:[{id:221,label:"查看"},{id:222,label:"新增"},{id:223,label:"编辑"},{id:224,label:"删除"}]},{id:23,label:"权限管理",children:[{id:231,label:"查看"},{id:232,label:"新增"},{id:233,label:"编辑"},{id:234,label:"删除"}]}]}]),N={children:"children",label:"label"},w=u(null),y=u([]),j=u([1,2,11,12,13,21,22,23]),$=T(()=>g.value.filter(n=>(r.name===""||n.name.includes(r.name))&&(r.status===""||n.status===r.status))),q=T(()=>{const n=(d.currentPage-1)*d.pageSize,e=n+d.pageSize;return $.value.slice(n,e)}),O=()=>{d.currentPage=1,c.success("查询成功")},K=()=>{r.name="",r.status="",d.currentPage=1},A=n=>{d.pageSize=n,d.currentPage=1},G=n=>{d.currentPage=n},H=()=>{k.value="新增角色",V.value=!1,f.value=!0},J=n=>{k.value="编辑角色",V.value=!0,Object.assign(i,n),f.value=!0},L=()=>{Object.assign(i,{id:0,name:"",description:"",status:"enabled"}),C.value&&C.value.resetFields()},Q=n=>{const e=n.status==="enabled"?"启用":"停用";c.success(`已${e}角色 "${n.name}"`)},W=()=>{C.value.validate(n=>{if(n){if(V.value){const e=g.value.findIndex(s=>s.id===i.id);e!==-1&&(g.value[e]={...i},c.success("角色更新成功"))}else{const e=Math.max(...g.value.map(s=>s.id),0)+1;g.value.push({...i,id:e,userCount:0}),c.success("角色添加成功")}f.value=!1}})},X=n=>{if(n.userCount>0){c.warning("该角色下有关联用户，无法删除");return}fe.confirm(`确定要删除角色 "${n.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=g.value.findIndex(s=>s.id===n.id);e!==-1&&(g.value.splice(e,1),c.success("删除成功"))}).catch(()=>{c.info("已取消删除")})},Y=n=>{w.value=n,y.value=[111,112,113,121,122,131,211,212,213],v.value=!0},Z=()=>{y.value=[],w.value=null},ee=()=>{const n=U.value.getCheckedNodes(!1,!0);console.log("选中的权限:",n),c.success(`"${w.value.name}" 的权限配置已保存`),v.value=!1};return re(()=>{x.value=!0,setTimeout(()=>{x.value=!1},500)}),(n,e)=>{const s=o("el-button"),h=o("el-input"),z=o("el-col"),R=o("el-option"),le=o("el-select"),te=o("el-row"),b=o("el-table-column"),D=o("el-switch"),ae=o("el-table"),ne=o("el-pagination"),se=o("el-card"),P=o("el-form-item"),oe=o("el-form"),B=o("el-dialog"),ie=o("el-tree"),de=ce("loading");return F(),pe("div",ve,[l(se,{class:"main-card"},{header:a(()=>[m("div",_e,[e[12]||(e[12]=m("span",null,"角色管理",-1)),m("div",Ce,[l(s,{type:"primary",onClick:H},{default:a(()=>[...e[11]||(e[11]=[p("新增角色",-1)])]),_:1})])])]),default:a(()=>[m("div",xe,[l(te,{gutter:20},{default:a(()=>[l(z,{span:8},{default:a(()=>[l(h,{modelValue:r.name,"onUpdate:modelValue":e[0]||(e[0]=t=>r.name=t),placeholder:"角色名称",clearable:""},null,8,["modelValue"])]),_:1}),l(z,{span:8},{default:a(()=>[l(le,{modelValue:r.status,"onUpdate:modelValue":e[1]||(e[1]=t=>r.status=t),placeholder:"状态",clearable:"",style:{width:"100%"}},{default:a(()=>[l(R,{label:"启用",value:"enabled"}),l(R,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),l(z,{span:8},{default:a(()=>[l(s,{type:"primary",onClick:O},{default:a(()=>[...e[13]||(e[13]=[p("查询",-1)])]),_:1}),l(s,{onClick:K},{default:a(()=>[...e[14]||(e[14]=[p("重置",-1)])]),_:1})]),_:1})]),_:1})]),me((F(),ge(ae,{data:q.value,style:{width:"100%","margin-top":"20px"},border:""},{default:a(()=>[l(b,{prop:"id",label:"ID",width:"80"}),l(b,{prop:"name",label:"角色名称",width:"200"}),l(b,{prop:"description",label:"角色描述"}),l(b,{prop:"userCount",label:"用户数量",width:"120"}),l(b,{prop:"status",label:"状态",width:"100"},{default:a(t=>[l(D,{modelValue:t.row.status,"onUpdate:modelValue":_=>t.row.status=_,"active-value":"enabled","inactive-value":"disabled",onChange:_=>Q(t.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),m("span",ke,E(t.row.status==="enabled"?"启用":"停用"),1)]),_:1}),l(b,{label:"操作",width:"200"},{default:a(t=>[l(s,{size:"small",onClick:_=>J(t.row)},{default:a(()=>[...e[15]||(e[15]=[p("编辑",-1)])]),_:1},8,["onClick"]),l(s,{size:"small",onClick:_=>Y(t.row)},{default:a(()=>[...e[16]||(e[16]=[p("权限配置",-1)])]),_:1},8,["onClick"]),l(s,{size:"small",type:"danger",onClick:_=>X(t.row)},{default:a(()=>[...e[17]||(e[17]=[p("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[de,x.value]]),l(ne,{"current-page":d.currentPage,"onUpdate:currentPage":e[2]||(e[2]=t=>d.currentPage=t),"page-size":d.pageSize,"onUpdate:pageSize":e[3]||(e[3]=t=>d.pageSize=t),"page-sizes":[10,20,50,100],total:$.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:A,onCurrentChange:G,style:{"margin-top":"20px","text-align":"right"}},null,8,["current-page","page-size","total"])]),_:1}),l(B,{title:k.value,modelValue:f.value,"onUpdate:modelValue":e[8]||(e[8]=t=>f.value=t),width:"600px",onClose:L},{footer:a(()=>[m("span",we,[l(s,{onClick:e[7]||(e[7]=t=>f.value=!1)},{default:a(()=>[...e[18]||(e[18]=[p("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:W},{default:a(()=>[...e[19]||(e[19]=[p("保存",-1)])]),_:1})])]),default:a(()=>[l(oe,{model:i,rules:M,ref_key:"roleForm",ref:C,"label-width":"100px"},{default:a(()=>[l(P,{label:"角色名称",prop:"name"},{default:a(()=>[l(h,{modelValue:i.name,"onUpdate:modelValue":e[4]||(e[4]=t=>i.name=t)},null,8,["modelValue"])]),_:1}),l(P,{label:"角色描述",prop:"description"},{default:a(()=>[l(h,{modelValue:i.description,"onUpdate:modelValue":e[5]||(e[5]=t=>i.description=t),type:"textarea"},null,8,["modelValue"])]),_:1}),l(P,{label:"状态"},{default:a(()=>[l(D,{modelValue:i.status,"onUpdate:modelValue":e[6]||(e[6]=t=>i.status=t),"active-value":"enabled","inactive-value":"disabled"},null,8,["modelValue"]),m("span",Ve,E(i.status==="enabled"?"启用":"停用"),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"]),l(B,{title:"权限配置",modelValue:v.value,"onUpdate:modelValue":e[10]||(e[10]=t=>v.value=t),width:"800px",onClose:Z},{footer:a(()=>[m("span",he,[l(s,{onClick:e[9]||(e[9]=t=>v.value=!1)},{default:a(()=>[...e[20]||(e[20]=[p("取消",-1)])]),_:1}),l(s,{type:"primary",onClick:ee},{default:a(()=>[...e[21]||(e[21]=[p("保存",-1)])]),_:1})])]),default:a(()=>[m("div",ye,[l(ie,{ref_key:"permissionTree",ref:U,data:I.value,"show-checkbox":"","node-key":"id",props:N,"default-checked-keys":y.value,"default-expanded-keys":j.value},null,8,["data","default-checked-keys","default-expanded-keys"])])]),_:1},8,["modelValue"])])}}}),Ue=be(ze,[["__scopeId","data-v-4b62120f"]]);export{Ue as default};
