import{d as le,e as f,l as I,f as q,m as te,c as B,a,w as t,r,b as _,q as oe,i as c,v as ne,k as F,t as S,F as se,g as re,E as b,x as ue,o as T,_ as de}from"./index-76Zfp96_.js";const ie={class:"indicator-configuration"},ce={class:"card-header"},me={style:{float:"right"}},pe={class:"filter-section"},ge={style:{"margin-left":"10px"}},fe={style:{"margin-left":"10px"}},_e={class:"dialog-footer"},ve=le({__name:"IndicatorConfiguration",setup(be){const U=f(!1),s=I({name:"",category:"",status:""}),d=I({currentPage:1,pageSize:10}),v=f(!1),k=f(""),z=f(!1),o=I({id:0,name:"",code:"",category:"",description:"",formula:"",sourceTable:"",status:"enabled"}),N={name:[{required:!0,message:"请输入指标名称",trigger:"blur"}],code:[{required:!0,message:"请输入指标编码",trigger:"blur"}],category:[{required:!0,message:"请选择指标分类",trigger:"change"}],description:[{required:!0,message:"请输入指标描述",trigger:"blur"}],formula:[{required:!0,message:"请输入计算公式",trigger:"blur"}],sourceTable:[{required:!0,message:"请选择数据源表",trigger:"change"}]},V=f(),$=f([{id:"sales_detail",name:"销售明细表"},{id:"user_behavior",name:"用户行为表"},{id:"product_info",name:"产品信息表"},{id:"order_summary",name:"订单汇总表"}]),m=f([{id:1,name:"总销售额",code:"total_sales_amount",category:"sales",description:"统计周期内的销售总额",formula:"SUM(sales_amount)",sourceTable:"sales_detail",status:"enabled"},{id:2,name:"订单数量",code:"order_count",category:"sales",description:"统计周期内的订单总数",formula:"COUNT(order_id)",sourceTable:"sales_detail",status:"enabled"},{id:3,name:"活跃用户数",code:"active_users",category:"user",description:"统计周期内的活跃用户数量",formula:"COUNT(DISTINCT user_id)",sourceTable:"user_behavior",status:"enabled"},{id:4,name:"平均客单价",code:"avg_order_value",category:"sales",description:"统计周期内平均每单的金额",formula:"SUM(sales_amount) / COUNT(order_id)",sourceTable:"sales_detail",status:"disabled"}]),P=q(()=>m.value.filter(n=>(s.name===""||n.name.includes(s.name))&&(s.category===""||n.category===s.category)&&(s.status===""||n.status===s.status))),h=q(()=>{const n=(d.currentPage-1)*d.pageSize,e=n+d.pageSize;return P.value.slice(n,e)}),E=()=>{d.currentPage=1,b.success("查询成功")},M=()=>{s.name="",s.category="",s.status="",d.currentPage=1},O=n=>{d.pageSize=n,d.currentPage=1},j=n=>{d.currentPage=n},L=()=>{k.value="新增指标",z.value=!1,v.value=!0},R=n=>{k.value="编辑指标",z.value=!0,Object.assign(o,n),v.value=!0},A=()=>{Object.assign(o,{id:0,name:"",code:"",category:"",description:"",formula:"",sourceTable:"",status:"enabled"}),V.value&&V.value.resetFields()},G=n=>{const e=n.status==="enabled"?"启用":"停用";b.success(`已${e}指标 "${n.name}"`)},H=()=>{V.value.validate(n=>{if(n){if(z.value){const e=m.value.findIndex(u=>u.id===o.id);e!==-1&&(m.value[e]={...o},b.success("指标更新成功"))}else{const e=Math.max(...m.value.map(u=>u.id),0)+1;m.value.push({...o,id:e}),b.success("指标添加成功")}v.value=!1}})},J=n=>{ue.confirm(`确定要删除指标 "${n.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const e=m.value.findIndex(u=>u.id===n.id);e!==-1&&(m.value.splice(e,1),b.success("删除成功"))}).catch(()=>{b.info("已取消删除")})};return te(()=>{U.value=!0,setTimeout(()=>{U.value=!1},500)}),(n,e)=>{const u=r("el-button"),y=r("el-input"),w=r("el-col"),i=r("el-option"),C=r("el-select"),K=r("el-row"),p=r("el-table-column"),Q=r("el-tag"),D=r("el-switch"),W=r("el-table"),X=r("el-pagination"),Y=r("el-card"),g=r("el-form-item"),Z=r("el-form"),ee=r("el-dialog"),ae=ne("loading");return T(),B("div",ie,[a(Y,{class:"main-card"},{header:t(()=>[_("div",ce,[e[15]||(e[15]=_("span",null,"指标配置",-1)),_("div",me,[a(u,{type:"primary",onClick:L},{default:t(()=>[...e[14]||(e[14]=[c("新增指标",-1)])]),_:1})])])]),default:t(()=>[_("div",pe,[a(K,{gutter:20},{default:t(()=>[a(w,{span:6},{default:t(()=>[a(y,{modelValue:s.name,"onUpdate:modelValue":e[0]||(e[0]=l=>s.name=l),placeholder:"指标名称",clearable:""},null,8,["modelValue"])]),_:1}),a(w,{span:6},{default:t(()=>[a(C,{modelValue:s.category,"onUpdate:modelValue":e[1]||(e[1]=l=>s.category=l),placeholder:"指标分类",clearable:"",style:{width:"100%"}},{default:t(()=>[a(i,{label:"销售类",value:"sales"}),a(i,{label:"用户类",value:"user"}),a(i,{label:"产品类",value:"product"}),a(i,{label:"财务类",value:"finance"})]),_:1},8,["modelValue"])]),_:1}),a(w,{span:6},{default:t(()=>[a(C,{modelValue:s.status,"onUpdate:modelValue":e[2]||(e[2]=l=>s.status=l),placeholder:"状态",clearable:"",style:{width:"100%"}},{default:t(()=>[a(i,{label:"启用",value:"enabled"}),a(i,{label:"停用",value:"disabled"})]),_:1},8,["modelValue"])]),_:1}),a(w,{span:6},{default:t(()=>[a(u,{type:"primary",onClick:E},{default:t(()=>[...e[16]||(e[16]=[c("查询",-1)])]),_:1}),a(u,{onClick:M},{default:t(()=>[...e[17]||(e[17]=[c("重置",-1)])]),_:1})]),_:1})]),_:1})]),oe((T(),F(W,{data:h.value,style:{width:"100%","margin-top":"20px"},border:""},{default:t(()=>[a(p,{prop:"id",label:"ID",width:"80"}),a(p,{prop:"name",label:"指标名称",width:"180"}),a(p,{prop:"code",label:"指标编码",width:"150"}),a(p,{prop:"category",label:"指标分类",width:"120"},{default:t(l=>[a(Q,{type:l.row.category==="sales"?"success":l.row.category==="user"?"primary":l.row.category==="product"?"warning":"info"},{default:t(()=>[c(S(l.row.category==="sales"?"销售类":l.row.category==="user"?"用户类":l.row.category==="product"?"产品类":"财务类"),1)]),_:2},1032,["type"])]),_:1}),a(p,{prop:"description",label:"指标描述"}),a(p,{prop:"status",label:"状态",width:"100"},{default:t(l=>[a(D,{modelValue:l.row.status,"onUpdate:modelValue":x=>l.row.status=x,"active-value":"enabled","inactive-value":"disabled",onChange:x=>G(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),_("span",ge,S(l.row.status==="enabled"?"启用":"停用"),1)]),_:1}),a(p,{label:"操作",width:"200"},{default:t(l=>[a(u,{size:"small",onClick:x=>R(l.row)},{default:t(()=>[...e[18]||(e[18]=[c("编辑",-1)])]),_:1},8,["onClick"]),a(u,{size:"small",type:"danger",onClick:x=>J(l.row)},{default:t(()=>[...e[19]||(e[19]=[c("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[ae,U.value]]),a(X,{"current-page":d.currentPage,"onUpdate:currentPage":e[3]||(e[3]=l=>d.currentPage=l),"page-size":d.pageSize,"onUpdate:pageSize":e[4]||(e[4]=l=>d.pageSize=l),"page-sizes":[10,20,50,100],total:P.value.length,layout:"total, sizes, prev, pager, next, jumper",onSizeChange:O,onCurrentChange:j,style:{"margin-top":"20px","text-align":"right"}},null,8,["current-page","page-size","total"])]),_:1}),a(ee,{title:k.value,modelValue:v.value,"onUpdate:modelValue":e[13]||(e[13]=l=>v.value=l),width:"600px",onClose:A},{footer:t(()=>[_("span",_e,[a(u,{onClick:e[12]||(e[12]=l=>v.value=!1)},{default:t(()=>[...e[20]||(e[20]=[c("取消",-1)])]),_:1}),a(u,{type:"primary",onClick:H},{default:t(()=>[...e[21]||(e[21]=[c("保存",-1)])]),_:1})])]),default:t(()=>[a(Z,{model:o,rules:N,ref_key:"indicatorForm",ref:V,"label-width":"100px"},{default:t(()=>[a(g,{label:"指标名称",prop:"name"},{default:t(()=>[a(y,{modelValue:o.name,"onUpdate:modelValue":e[5]||(e[5]=l=>o.name=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"指标编码",prop:"code"},{default:t(()=>[a(y,{modelValue:o.code,"onUpdate:modelValue":e[6]||(e[6]=l=>o.code=l)},null,8,["modelValue"])]),_:1}),a(g,{label:"指标分类",prop:"category"},{default:t(()=>[a(C,{modelValue:o.category,"onUpdate:modelValue":e[7]||(e[7]=l=>o.category=l),style:{width:"100%"}},{default:t(()=>[a(i,{label:"销售类",value:"sales"}),a(i,{label:"用户类",value:"user"}),a(i,{label:"产品类",value:"product"}),a(i,{label:"财务类",value:"finance"})]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"指标描述",prop:"description"},{default:t(()=>[a(y,{modelValue:o.description,"onUpdate:modelValue":e[8]||(e[8]=l=>o.description=l),type:"textarea"},null,8,["modelValue"])]),_:1}),a(g,{label:"计算公式",prop:"formula"},{default:t(()=>[a(y,{modelValue:o.formula,"onUpdate:modelValue":e[9]||(e[9]=l=>o.formula=l),type:"textarea"},null,8,["modelValue"])]),_:1}),a(g,{label:"数据源表",prop:"sourceTable"},{default:t(()=>[a(C,{modelValue:o.sourceTable,"onUpdate:modelValue":e[10]||(e[10]=l=>o.sourceTable=l),style:{width:"100%"}},{default:t(()=>[(T(!0),B(se,null,re($.value,l=>(T(),F(i,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),a(g,{label:"状态"},{default:t(()=>[a(D,{modelValue:o.status,"onUpdate:modelValue":e[11]||(e[11]=l=>o.status=l),"active-value":"enabled","inactive-value":"disabled"},null,8,["modelValue"]),_("span",fe,S(o.status==="enabled"?"启用":"停用"),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),Ve=de(ve,[["__scopeId","data-v-9bdf9694"]]);export{Ve as default};
