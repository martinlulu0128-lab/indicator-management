import{d as W,e as I,l as P,f as $,m as X,c as Y,a as t,w as a,r,b as v,q as ee,i as f,v as te,k as le,t as x,y as ae,E as b,x as de,o as B,_ as ne}from"./index-76Zfp96_.js";const oe={class:"permission-management"},se={class:"card-header"},ie={style:{float:"right"}},re={class:"filter-section"},ue={style:{"margin-left":"10px"}},me={style:{"margin-left":"10px"}},ce={class:"dialog-footer"},pe=W({__name:"PermissionManagement",setup(ve){const C=I(!1),c=P({name:"",module:""}),_=I(!1),k=I(""),g=I(!1),n=P({id:0,parentId:[],name:"",code:"",module:"",description:"",status:"enabled",level:0}),M={name:[{required:!0,message:"请输入权限名称",trigger:"blur"},{min:2,max:20,message:"权限名称长度应在2-20个字符之间",trigger:"blur"}],code:[{required:!0,message:"请输入权限编码",trigger:"blur"},{pattern:/^[a-zA-Z0-9_:]+$/,message:"权限编码只能包含字母、数字、下划线和冒号",trigger:"blur"}],module:[{required:!0,message:"请选择所属模块",trigger:"change"}],description:[{required:!0,message:"请输入权限描述",trigger:"blur"},{max:100,message:"权限描述最多100个字符",trigger:"blur"}]},V=I(),q={value:"id",label:"name",children:"children",emitPath:!1,checkStrictly:!0},u=I([{id:1,parentId:0,name:"指标管理",code:"indicator:*",module:"indicator",description:"指标管理模块",status:"enabled",level:0},{id:11,parentId:1,name:"指标明细表管理",code:"indicator:table:*",module:"indicator",description:"指标明细表管理",status:"enabled",level:1},{id:111,parentId:11,name:"查看",code:"indicator:table:view",module:"indicator",description:"查看指标明细表",status:"enabled",level:2},{id:112,parentId:11,name:"新增",code:"indicator:table:create",module:"indicator",description:"新增指标明细表",status:"enabled",level:2},{id:113,parentId:11,name:"编辑",code:"indicator:table:update",module:"indicator",description:"编辑指标明细表",status:"enabled",level:2},{id:114,parentId:11,name:"删除",code:"indicator:table:delete",module:"indicator",description:"删除指标明细表",status:"enabled",level:2},{id:12,parentId:1,name:"指标配置",code:"indicator:config:*",module:"indicator",description:"指标配置管理",status:"enabled",level:1},{id:121,parentId:12,name:"查看",code:"indicator:config:view",module:"indicator",description:"查看指标配置",status:"enabled",level:2},{id:122,parentId:12,name:"新增",code:"indicator:config:create",module:"indicator",description:"新增指标配置",status:"enabled",level:2},{id:123,parentId:12,name:"编辑",code:"indicator:config:update",module:"indicator",description:"编辑指标配置",status:"enabled",level:2},{id:124,parentId:12,name:"删除",code:"indicator:config:delete",module:"indicator",description:"删除指标配置",status:"enabled",level:2},{id:13,parentId:1,name:"指标监控",code:"indicator:monitor:*",module:"indicator",description:"指标监控管理",status:"enabled",level:1},{id:131,parentId:13,name:"查看",code:"indicator:monitor:view",module:"indicator",description:"查看指标监控",status:"enabled",level:2},{id:132,parentId:13,name:"新增",code:"indicator:monitor:create",module:"indicator",description:"新增指标监控",status:"enabled",level:2},{id:133,parentId:13,name:"编辑",code:"indicator:monitor:update",module:"indicator",description:"编辑指标监控",status:"enabled",level:2},{id:134,parentId:13,name:"删除",code:"indicator:monitor:delete",module:"indicator",description:"删除指标监控",status:"enabled",level:2},{id:2,parentId:0,name:"系统管理",code:"system:*",module:"system",description:"系统管理模块",status:"enabled",level:0},{id:21,parentId:2,name:"用户管理",code:"system:user:*",module:"system",description:"用户管理",status:"enabled",level:1},{id:211,parentId:21,name:"查看",code:"system:user:view",module:"system",description:"查看用户",status:"enabled",level:2},{id:212,parentId:21,name:"新增",code:"system:user:create",module:"system",description:"新增用户",status:"enabled",level:2},{id:213,parentId:21,name:"编辑",code:"system:user:update",module:"system",description:"编辑用户",status:"enabled",level:2},{id:214,parentId:21,name:"删除",code:"system:user:delete",module:"system",description:"删除用户",status:"enabled",level:2},{id:22,parentId:2,name:"角色管理",code:"system:role:*",module:"system",description:"角色管理",status:"enabled",level:1},{id:221,parentId:22,name:"查看",code:"system:role:view",module:"system",description:"查看角色",status:"enabled",level:2},{id:222,parentId:22,name:"新增",code:"system:role:create",module:"system",description:"新增角色",status:"enabled",level:2},{id:223,parentId:22,name:"编辑",code:"system:role:update",module:"system",description:"编辑角色",status:"enabled",level:2},{id:224,parentId:22,name:"删除",code:"system:role:delete",module:"system",description:"删除角色",status:"enabled",level:2},{id:23,parentId:2,name:"权限管理",code:"system:permission:*",module:"system",description:"权限管理",status:"enabled",level:1},{id:231,parentId:23,name:"查看",code:"system:permission:view",module:"system",description:"查看权限",status:"enabled",level:2},{id:232,parentId:23,name:"新增",code:"system:permission:create",module:"system",description:"新增权限",status:"enabled",level:2},{id:233,parentId:23,name:"编辑",code:"system:permission:update",module:"system",description:"编辑权限",status:"enabled",level:2},{id:234,parentId:23,name:"删除",code:"system:permission:delete",module:"system",description:"删除权限",status:"enabled",level:2}]),D=$(()=>{let s=u.value;c.name&&(s=s.filter(o=>o.name.includes(c.name))),c.module&&(s=s.filter(o=>o.module===c.module));const e={},d=[];return s.forEach(o=>{e[o.id]={...o,children:[]}}),s.forEach(o=>{const p=e[o.id];if(o.parentId===0)d.push(p);else{const i=e[o.parentId];i&&i.children.push(p)}}),d}),F=$(()=>{const s=[];return u.value.filter(d=>d.parentId===0).forEach(d=>{if(g.value&&n.id===d.id)return;const o={id:d.id,name:d.name,children:[]};u.value.filter(i=>i.parentId===d.id).forEach(i=>{if(g.value&&n.id===i.id)return;const w={id:i.id,name:i.name,children:[]};u.value.filter(m=>m.parentId===i.id).forEach(m=>{g.value&&n.id===m.id||w.children.push({id:m.id,name:m.name})}),o.children.push(w)}),s.push(o)}),s}),T=()=>{b.success("查询成功")},z=()=>{c.name="",c.module=""},O=()=>{k.value="新增权限",g.value=!1,_.value=!0},S=s=>{k.value="编辑权限",g.value=!0,Object.assign(n,s),n.parentId=s.parentId,_.value=!0},L=()=>{Object.assign(n,{id:0,parentId:[],name:"",code:"",module:"",description:"",status:"enabled",level:0}),V.value&&V.value.resetFields()},N=s=>{const e=s.status==="enabled"?"启用":"停用";b.success(`已${e}权限 "${s.name}"`)},j=()=>{V.value.validate(s=>{if(s){if(g.value){const e=u.value.findIndex(d=>d.id===n.id);e!==-1&&(u.value[e]={...n},b.success("权限更新成功"))}else{const e=Math.max(...u.value.map(i=>i.id),0)+1,d=n.parentId||0,o=u.value.find(i=>i.id===d),p=o?o.level+1:0;u.value.push({...n,id:e,parentId:d,level:p}),b.success("权限添加成功")}_.value=!1}})},A=s=>{if(u.value.some(d=>d.parentId===s.id)){b.warning("该权限下有子权限，请先删除子权限");return}de.confirm(`确定要删除权限 "${s.name}" 吗？`,"确认删除",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(()=>{const d=u.value.findIndex(o=>o.id===s.id);d!==-1&&(u.value.splice(d,1),b.success("删除成功"))}).catch(()=>{b.info("已取消删除")})};return X(()=>{C.value=!0,setTimeout(()=>{C.value=!1},500)}),(s,e)=>{const d=r("el-button"),o=r("el-input"),p=r("el-col"),i=r("el-option"),w=r("el-select"),E=r("el-row"),m=r("el-table-column"),R=r("el-tag"),U=r("el-switch"),Z=r("el-table"),G=r("el-card"),H=r("el-cascader"),y=r("el-form-item"),J=r("el-form"),K=r("el-dialog"),Q=te("loading");return B(),Y("div",oe,[t(G,{class:"main-card"},{header:a(()=>[v("div",se,[e[11]||(e[11]=v("span",null,"权限管理",-1)),v("div",ie,[t(d,{type:"primary",onClick:O},{default:a(()=>[...e[10]||(e[10]=[f("新增权限",-1)])]),_:1})])])]),default:a(()=>[v("div",re,[t(E,{gutter:20},{default:a(()=>[t(p,{span:8},{default:a(()=>[t(o,{modelValue:c.name,"onUpdate:modelValue":e[0]||(e[0]=l=>c.name=l),placeholder:"权限名称",clearable:""},null,8,["modelValue"])]),_:1}),t(p,{span:8},{default:a(()=>[t(w,{modelValue:c.module,"onUpdate:modelValue":e[1]||(e[1]=l=>c.module=l),placeholder:"所属模块",clearable:"",style:{width:"100%"}},{default:a(()=>[t(i,{label:"指标管理",value:"indicator"}),t(i,{label:"系统管理",value:"system"})]),_:1},8,["modelValue"])]),_:1}),t(p,{span:8},{default:a(()=>[t(d,{type:"primary",onClick:T},{default:a(()=>[...e[12]||(e[12]=[f("查询",-1)])]),_:1}),t(d,{onClick:z},{default:a(()=>[...e[13]||(e[13]=[f("重置",-1)])]),_:1})]),_:1})]),_:1})]),ee((B(),le(Z,{data:D.value,style:{width:"100%","margin-top":"20px"},border:"","row-key":"id","tree-props":{children:"children",hasChildren:"hasChildren"}},{default:a(()=>[t(m,{prop:"name",label:"权限名称",width:"250"},{default:a(l=>[v("span",{style:ae({paddingLeft:l.row.level*20+"px"})},x(l.row.name),5)]),_:1}),t(m,{prop:"code",label:"权限编码",width:"200"}),t(m,{prop:"module",label:"所属模块",width:"150"},{default:a(l=>[t(R,{type:l.row.module==="indicator"?"success":"primary"},{default:a(()=>[f(x(l.row.module==="indicator"?"指标管理":"系统管理"),1)]),_:2},1032,["type"])]),_:1}),t(m,{prop:"description",label:"权限描述"}),t(m,{prop:"status",label:"状态",width:"100"},{default:a(l=>[t(U,{modelValue:l.row.status,"onUpdate:modelValue":h=>l.row.status=h,"active-value":"enabled","inactive-value":"disabled",onChange:h=>N(l.row)},null,8,["modelValue","onUpdate:modelValue","onChange"]),v("span",ue,x(l.row.status==="enabled"?"启用":"停用"),1)]),_:1}),t(m,{label:"操作",width:"200"},{default:a(l=>[t(d,{size:"small",onClick:h=>S(l.row)},{default:a(()=>[...e[14]||(e[14]=[f("编辑",-1)])]),_:1},8,["onClick"]),t(d,{size:"small",type:"danger",onClick:h=>A(l.row)},{default:a(()=>[...e[15]||(e[15]=[f("删除",-1)])]),_:1},8,["onClick"])]),_:1})]),_:1},8,["data"])),[[Q,C.value]])]),_:1}),t(K,{title:k.value,modelValue:_.value,"onUpdate:modelValue":e[9]||(e[9]=l=>_.value=l),width:"600px",onClose:L},{footer:a(()=>[v("span",ce,[t(d,{onClick:e[8]||(e[8]=l=>_.value=!1)},{default:a(()=>[...e[16]||(e[16]=[f("取消",-1)])]),_:1}),t(d,{type:"primary",onClick:j},{default:a(()=>[...e[17]||(e[17]=[f("保存",-1)])]),_:1})])]),default:a(()=>[t(J,{model:n,rules:M,ref_key:"permissionForm",ref:V,"label-width":"100px"},{default:a(()=>[t(y,{label:"上级权限"},{default:a(()=>[t(H,{modelValue:n.parentId,"onUpdate:modelValue":e[2]||(e[2]=l=>n.parentId=l),options:F.value,props:q,clearable:"",style:{width:"100%"}},null,8,["modelValue","options"])]),_:1}),t(y,{label:"权限名称",prop:"name"},{default:a(()=>[t(o,{modelValue:n.name,"onUpdate:modelValue":e[3]||(e[3]=l=>n.name=l)},null,8,["modelValue"])]),_:1}),t(y,{label:"权限编码",prop:"code"},{default:a(()=>[t(o,{modelValue:n.code,"onUpdate:modelValue":e[4]||(e[4]=l=>n.code=l)},null,8,["modelValue"])]),_:1}),t(y,{label:"所属模块",prop:"module"},{default:a(()=>[t(w,{modelValue:n.module,"onUpdate:modelValue":e[5]||(e[5]=l=>n.module=l),style:{width:"100%"}},{default:a(()=>[t(i,{label:"指标管理",value:"indicator"}),t(i,{label:"系统管理",value:"system"})]),_:1},8,["modelValue"])]),_:1}),t(y,{label:"权限描述",prop:"description"},{default:a(()=>[t(o,{modelValue:n.description,"onUpdate:modelValue":e[6]||(e[6]=l=>n.description=l),type:"textarea"},null,8,["modelValue"])]),_:1}),t(y,{label:"状态"},{default:a(()=>[t(U,{modelValue:n.status,"onUpdate:modelValue":e[7]||(e[7]=l=>n.status=l),"active-value":"enabled","inactive-value":"disabled"},null,8,["modelValue"]),v("span",me,x(n.status==="enabled"?"启用":"停用"),1)]),_:1})]),_:1},8,["model"])]),_:1},8,["title","modelValue"])])}}}),be=ne(pe,[["__scopeId","data-v-ed294e48"]]);export{be as default};
